# copyMan v4 開発・修正記録

## 1. ドラッグアンドドロップ機能の修正

### 問題の概要
copyMan v4において、ディレクトリのドラッグアンドドロップ機能が正常に動作しない問題が発生。

### 発生していた問題
1. ドラッグアンドドロップ操作を受け付けない
2. ディレクトリをドロップしても選択リストに追加されない

### 修正内容
1. 専用の`DroppableQListWidget`クラスを作成
2. 各イベントハンドラ（`dragEnterEvent`, `dragMoveEvent`, `dropEvent`）を適切に実装
3. 重複チェックと既存ディレクトリの確認機能を追加

## 2. プロジェクト構造の改善

### Poetry対応
1. プロジェクトをPoetryで管理するように変更
   - `pyproject.toml`の作成
   - 依存関係の明確化（PyQt6など）
   - スクリプトエントリポイントの設定

2. モジュール構造の整理
   - `mod`パッケージの構造を改善
   ```
   mod/
   ├── __init__.py
   ├── copy_support/
   │   ├── __init__.py
   │   ├── main.py
   │   ├── win.py
   │   └── mac_linux.py
   └── toma_logger/
       ├── __init__.py
       └── logger.py
   ```

3. インポート文の修正
   ```python
   from mod.copy_support.main import CopyManager
   from mod.toma_logger.logger import TomaLogger
   ```

### バージョン管理の改善
1. `.gitignore`の整備
   - 不要なキャッシュファイルの除外
   - 環境依存ファイルの除外
   - IDE関連ファイルの除外

2. プロジェクトのバージョン管理
   - バージョン番号の明確化（v0.4.0）
   - 変更履歴の記録

## 3. テスト環境の整備

### 実装内容
1. PyTestによるテスト環境の構築
   - pytest, pytest-cov, pytest-qtの導入
   - テストの分類（GUI/非GUI）
   - カバレッジレポートの生成

2. 基本的なユニットテストの実装
   - DirectoryCopierAppのテスト
   - DroppableQListWidgetのテスト
   - CopyManagerのテスト
   - TomaLoggerのテスト

3. CI/CD環境の構築
   - GitHub Actionsの設定
   - 自動テスト実行の設定
   - カバレッジレポートの自動アップロード

### テストの分類
1. **GUIテスト (`@pytest.mark.gui`):**
   - DirectoryCopierAppの初期状態テスト
   - ディレクトリ表示のテスト
   - DroppableQListWidgetの機能テスト
   - 並列コピー設定のテスト

2. **非GUIテスト:**
   - コピー機能のテスト
   - モジュールのインポートテスト
   - ロガー機能のテスト

### 今後の課題
1. テストカバレッジの向上
   - 未カバーのコード部分の特定
   - テストケースの追加

2. 結合テストの追加
   - 複数機能の連携テスト
   - エラー処理の統合テスト

3. パフォーマンステストの実装
   - 大量ファイルのコピーテスト
   - 並列処理の効率テスト

4. GUIテストの安定性向上
   - テスト環境の改善
   - モック/スタブの活用
